#!/bin/sh
PATH=${PATH}:/usr/local/bin
export PATH
libname=$1
CPPFLAGS=$2
shift; shift
docdirbase="/tmp/libdoc"
docdir="/tmp/libdoc/$libname"
[ -d $docdirbase ] || mkdir $docdirbase
[ -d $docdir ] || mkdir $docdir
for i in $*; do
    if expr $i : '.*\.f90$' > /dev/null; then
	cpp $CPPFLAGS -P $i > $docdir/$i
	( cd $docdir; f90doc $i )
	rm -f $docdir/$i
    fi
done
contents="$docdir/index.html"
	echo "<HTML><HEAD><TITLE>$libname library documentation</TITLE></HEAD><BODY>" > $contents
    	echo "<H2>$libname library documentation generated by f90doc</H2>" >> $contents
        echo "<A HREF="http://cvs-internal.isis.rl.ac.uk/cgi-bin/viewcvs.cgi/libisisexc/$libname">$libname files on the central CVS server</A><P>" >> $contents
	echo "<B>Pubic Modules [prefix: IXM]</B>" >> $contents
    	echo "<UL>" >> $contents
	for i in ixm*.html; do
	    name=`basename $i .html | sed -e 's/^ixm/IXM/'`
            echo "<LI><A HREF=\"$i\">$name</A>" >> $contents
        done
	echo "</UL><P>" >> $contents
	echo "<B>Public Global Functions/Subroutines [prefix: IXF]</B>" >> $contents
    	echo "<UL>" >> $contents
    	for i in ixf*.html; do
	    name=`basename $i .html | sed -e 's/^ixf/IXF/'`
            echo "<LI><A HREF=\"$i\">$name</A>" >> $contents
        done
	echo "</UL><P>" >> $contents
	echo "<B>Non-Public Functions/Subroutines</B><BR>These are listed here as an aid for developers, but may be changed at any time and so should NOT be relied upon by non-developers</B>" >> $contents
    	echo "<UL>" >> $contents
    	for i in *.html; do
	    ii=`echo $i | sed -e 's/^ixm//' -e 's/^ixf//' -e 's/^ixb//'`
	    if test "$i" = "$ii"; then
                echo "<LI><A HREF=\"$i\">"`basename $i .html`"</A>" >> $contents
	    fi
        done
        echo "</UL><P>" >> $contents
	echo "<B>Binding Functions/Subroutines [prefix: IXB]</B><BR>External binding functions (many are automatically generated)" >> $contents
    	echo "<UL>" >> $contents
    	for i in ixb*.html; do
	    name=`basename $i .html | sed -e 's/^ixb/IXB/'`
            echo "<LI><A HREF=\"$i\">$name</A>" >> $contents
        done
	echo "</UL><P>" >> $contents
        echo "</BODY></HTML>" >> $contents
